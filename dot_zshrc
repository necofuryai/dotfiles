# ============================================
# .zshrc
# ============================================

for f in ~/.config/shell/{common,zsh}.sh; do
    [ -r "$f" ] && . "$f"
done

if [[ "$(uname)" == "Darwin" ]]; then
    alias brewup='brew update && brew upgrade --greedy && brew autoremove && brew cleanup && brew doctor; if ! git -C ~/.local/share/chezmoi diff --quiet; then git -C ~/.local/share/chezmoi add -A && git -C ~/.local/share/chezmoi commit -m "update dotfiles" && git -C ~/.local/share/chezmoi push; fi'

    # brew() and _update_brewfile defined in zsh.sh
    export EDITOR=nvim

    # Claude
    alias claude-or='ANTHROPIC_BASE_URL="https://openrouter.ai/api" ANTHROPIC_AUTH_TOKEN="$(op read "op://Personal/OPENROUTER_API_KEY/credential")" ANTHROPIC_API_KEY="" MAX_THINKING_TOKENS="0" claude'
    alias claude-mm='ANTHROPIC_BASE_URL="https://api.minimax.io/anthropic" ANTHROPIC_AUTH_TOKEN="$(op read "op://Personal/MINIMAX_API_KEY/credential")" ANTHROPIC_MODEL="MiniMax-M2.1" claude'
    alias claude-mem='bun "/Users/masyusakai/.claude/plugins/marketplaces/thedotmack/plugin/scripts/worker-service.cjs"'

    # Go
    export GOENV_ROOT="$HOME/.goenv"
    export PATH="$GOENV_ROOT/bin:$PATH"
    eval "$(goenv init -)"
    export PATH="$GOPATH/bin:$PATH"
fi

pdfview() {
  local pdf="$1"
  local dpi="${2:-200}"
  local pages=$(mutool info "$pdf" 2>/dev/null | grep "^Pages:" | awk '{print $2}')

  if [[ "$pages" -gt 50 ]]; then
    echo "This PDF has $pages pages. Continue? [y/N]"
    read -r answer
    [[ "$answer" != [yY] ]] && return 0
  fi

  local tmp_dir="/tmp/pdfview_$$"
  mkdir -p "$tmp_dir"
  mutool draw -o "$tmp_dir/page%d.png" -r "$dpi" "$pdf"
  timg -W "$tmp_dir"/page*.png
  rm -rf "$tmp_dir"
}
